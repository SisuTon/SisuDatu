#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π AntiFraud
"""

import asyncio
import logging
import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É
sys.path.append(str(Path(__file__).parent))

from sisu_bot.bot.middlewares.antifraud import AntiFraudMiddleware

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

def test_antifraud_settings():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ AntiFraud"""
    print("üõ°Ô∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ AntiFraud")
    print("=" * 60)
    
    print("–ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:")
    print("1. –£–º–µ–Ω—å—à–µ–Ω –ª–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏ –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏: 2s ‚Üí 0.5s")
    print("2. –£–≤–µ–ª–∏—á–µ–Ω –ª–∏–º–∏—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π: 3 ‚Üí 5")
    print("3. –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–æ–≤:")
    print("   - /unblock [user_id] ‚Äî —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    print("   - /check_activity [user_id] ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å")
    print()
    
    print("–ù–û–í–´–ï –ù–ê–°–¢–†–û–ô–ö–ò:")
    print("- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏: 0.5 —Å–µ–∫—É–Ω–¥—ã")
    print("- –õ–∏–º–∏—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π: 5 (–≤–º–µ—Å—Ç–æ 3)")
    print("- –ú–∞–∫—Å–∏–º—É–º —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Å: 30")
    print("- –õ–∏–º–∏—Ç –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 20 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Å")

def test_user_activity_functions():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
    print("\nüë§ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
    print("=" * 50)
    
    test_user_id = 12345
    
    # –¢–µ—Å—Ç —Å–±—Ä–æ—Å–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    print("1. –¢–µ—Å—Ç —Å–±—Ä–æ—Å–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:")
    AntiFraudMiddleware.reset_user_activity(test_user_id)
    print(f"‚úÖ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {test_user_id} —Å–±—Ä–æ—à–µ–Ω–∞")
    
    # –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    print("\n2. –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:")
    activity = AntiFraudMiddleware.get_user_activity(test_user_id)
    print(f"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {test_user_id}: {activity}")
    
    # –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    print("\n3. –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:")
    activity = AntiFraudMiddleware.get_user_activity(99999)
    print(f"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {activity}")

def test_antifraud_scenarios():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ AntiFraud"""
    print("\nüé≠ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ AntiFraud")
    print("=" * 50)
    
    print("–°–¶–ï–ù–ê–†–ò–ò:")
    print("1. –ù–æ—Ä–º–∞–ª—å–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:")
    print("   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º > 0.5s")
    print("   - –ù–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 30 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Å")
    print("   - –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è")
    print()
    
    print("2. –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:")
    print("   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º < 0.5s")
    print("   - –ù–∞–∫–æ–ø–∏–ª 5+ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π")
    print("   - –ë–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è")
    print()
    
    print("3. –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –≤—ã—Å–æ–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é:")
    print("   - –ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω < 1 —á–∞—Å–∞ –Ω–∞–∑–∞–¥")
    print("   - –û—Ç–ø—Ä–∞–≤–∏–ª > 20 —Å–æ–æ–±—â–µ–Ω–∏–π")
    print("   - –ú–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω")
    print()
    
    print("4. –ê–¥–º–∏–Ω—ã –∏ —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω—ã:")
    print("   - –ò—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫ AntiFraud")
    print("   - –ú–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π")

def test_admin_commands():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∞–¥–º–∏–Ω–æ–≤"""
    print("\nüëë –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤")
    print("=" * 50)
    
    print("–ù–û–í–´–ï –ö–û–ú–ê–ù–î–´ –î–õ–Ø –°–£–ü–ï–†-–ê–î–ú–ò–ù–û–í:")
    print()
    print("1. /unblock [user_id]")
    print("   - –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç AntiFraud")
    print("   - –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π")
    print("   - –û—á–∏—â–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π")
    print()
    
    print("2. /check_activity [user_id]")
    print("   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    print("   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π")
    print("   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π")
    print("   - –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞")
    print()
    
    print("–ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:")
    print("/unblock 1592757852")
    print("/check_activity 1592757852")

def test_antifraud_improvements():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è AntiFraud"""
    print("\nüöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ª—É—á—à–µ–Ω–∏–π AntiFraud")
    print("=" * 50)
    
    print("–£–õ–£–ß–®–ï–ù–ò–Ø:")
    print("1. –ë–æ–ª–µ–µ –º—è–≥–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:")
    print("   - –í—Ä–µ–º—è –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏: 2s ‚Üí 0.5s")
    print("   - –õ–∏–º–∏—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏: 3 ‚Üí 5 –¥–µ–π—Å—Ç–≤–∏–π")
    print()
    
    print("2. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∞–¥–º–∏–Ω–æ–≤:")
    print("   - –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
    print("   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏")
    print("   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã")
    print()
    
    print("3. –õ—É—á—à–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:")
    print("   - –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏")
    print("   - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏")
    print("   - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–±—Ä–æ—Å–∞")

def test_problem_solution():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã"""
    print("\nüîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã")
    print("=" * 50)
    
    print("–ü–†–û–ë–õ–ï–ú–ê:")
    print("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1592757852 –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω AntiFraud")
    print("–ü—Ä–∏—á–∏–Ω–∞: –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ (0.0s –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏)")
    print()
    
    print("–†–ï–®–ï–ù–ò–ï:")
    print("1. –°–º—è–≥—á–µ–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è AntiFraud")
    print("2. –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏")
    print("3. –£–ª—É—á—à–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞")
    print()
    
    print("–ö–ê–ö –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ê–¢–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:")
    print("1. –°—É–ø–µ—Ä-–∞–¥–º–∏–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç: /unblock 1592757852")
    print("2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: /check_activity 1592757852")
    print("3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–Ω–æ–≤–∞ –ø–∏—Å–∞—Ç—å –≤ —á–∞—Ç")

async def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    print("üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π AntiFraud")
    print("=" * 70)
    
    try:
        test_antifraud_settings()
        test_user_activity_functions()
        test_antifraud_scenarios()
        test_admin_commands()
        test_antifraud_improvements()
        test_problem_solution()
        
        print("\n‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!")
        print("AntiFraud –∏—Å–ø—Ä–∞–≤–ª–µ–Ω! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–æ–ª—å—à–µ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è! üõ°Ô∏è")
        
    except Exception as e:
        print(f"\n‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}")
        logger.exception("Test error")

if __name__ == "__main__":
    asyncio.run(main())
